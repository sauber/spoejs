%# front page
%#
%# License: Artistic License
%#          http://www.opensource.org/licenses/artistic-license.php
%#
%# $Id: index.html,v 1.43 2004/05/18 02:16:48 snicki Exp $
%#
<table width="100%"><tr>
% if ( @{$remotes} > 0 ) {
<td width="50%" valign="top">
%} else {
<td width="100%" valign="top">
%}
<h1>
%#<&|/l&>spoejs_channels_at_this_site</&>
<&|/l&>localjournal</&>
</h1>
% foreach my $chan ( @channels ) {
<h2>
<a href="/<% $chan->channel_dir() %>/index.html">
<% $chan->get( 'title' ) %>
</a>
</h2>
% if ( $chan->{S} ) {
% $spoejs{channel_path} = $chan->{path};
% $spoejs{channel} = $chan->channel_dir();
% $spoejs{p}{t} = $chan->get('theme');
<& /w, w => 'abstract', box => 1, storyref => $chan->{S} &>
<br clear="all"/>
% } else {
<&|/l&>no_stories</&>
% }
%# Cleanup above assigmnets
% delete $spoejs{channel_path};
% delete $spoejs{channel};
<br/>
% }
</td>
% if ( @{$remotes} > 0 ) {
<td width="50%" valign="top">
<h1><&|/l&>journals_friends</&></h1>
%for my $rem ( @{$remotes} ) {
<h2><a href="<% $rem->{url} . '/' . $rem->{shortname} .'/index.html' %>">
<%$rem->{shortname}%> at <% $rem->{url} %></a></h2>
<% $rem->{summary} %><br/><br/>
%}
</td>
%}
</tr></table>
<hr/>
<a href="/htm/admin/siteconfig.html">
<&|/l&>siteconf</&>
</a>
<%init>
my $CL = new Spoejs::ChannelList( path => "$ENV{DOCUMENT_ROOT}/users/",
                                  lang => $spoejs{lang_handle} );
$spoejs{error}{$m->current_comp->source_file} = $CL->{msg} if $CL->{msg};

my @channels;
my @auth =  keys %{$session{chanauth}} if defined $session{chanauth};
@channels = $CL->newest_channels( auth => \@auth )  unless $CL->{msg};

my $SYN = new Spoejs::Syndication( path => "$ENV{DOCUMENT_ROOT}/../lib/",
                                   lang => $spoejs{lang_handle} );
my $remotes = $SYN->newest_remotes( count => scalar @channels );
</%init>
