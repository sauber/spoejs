<& /w, w => 'media-page',
      ML => $ML,
      S  => $S,
      back_href => $back_href,
      img_href  => $img_href,
      img_src   => $img_src,
      filename  => $filename,
      navi_opt  => \%navi_opt
&>
<%init>
my $web_path = "/users/$spoejs{channel}/$spoejs{p}{d}";
my $path = "$ENV{DOCUMENT_ROOT}$web_path";

my $ML = new Spoejs::MediaList( path => $path );
$spoejs{error}{$m->current_comp->source_file} = $ML->{msg} if $ML->{msg};

my $S = new Spoejs::Story( path => $path, lang => $spoejs{lang_handle} );
$spoejs{error}{$m->current_comp->source_file} = $S->{msg} if $S->{msg};

my $picref    = ($ML->list())[$spoejs{p}{s}]
  or $spoejs{error}{$m->current_comp->source_file} = $ML->{msg};

my $back_href = $m->scomp( "url:encode", 'story.html', d => $spoejs{p}{d} );
my $img_href  = "$web_path/$picref->{file}";

my $img_src   = $m->scomp( '/w', w => "media", d => $spoejs{p}{d},
			   p => $picref->{file}, m => 480 );

my $filename  = $picref->utf_filename();

my %navi_opt = ( url => "/$spoejs{channel}/media.html",
		 count => 1,
		 start => $spoejs{p}{s},
		 list_ref => $ML );

</%init>