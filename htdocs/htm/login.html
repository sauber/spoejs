<%init>
if ( $login ) {

  my $CL = new Spoejs::ChannelList( path => "$ENV{DOCUMENT_ROOT}/users/" );

  my @channels = $CL->search_channels( username => $username,
	                               password => $password );

  for ( @channels ) {
    my $sn = $_->get( 'shortname' );
    $session{chanauth}{$sn} = 1;
  }

} elsif ( $logout ) {

  delete $session{chanauth};
}

$m->redirect( $ENV{HTTP_REFERER} );

</%init>
<%args>
$username => undef
$password => undef
$login    => undef
$logout   => undef
</%args>
