<%init>
if ( $login ) {

  my $CL = new Spoejs::ChannelList( path => "$ENV{DOCUMENT_ROOT}/users/",
                                    lang => $spoejs{lang_handle} );
  $spoejs{error}{$m->current_comp->source_file} = $CL->{msg} if $CL->{msg};

  my @channels;
  @channels = $CL->search_channels( username => $username,
	                            password => $password )
    unless $CL->{msg};
  @channels = () if $channels[0] eq undef;

  for my $c ( @channels ) {
    my $sn = $c->get( 'shortname' );
    $session{chanauth}{$sn} = 1;
  }

} elsif ( $logout ) {

  delete $session{chanauth};
}

$m->redirect( $ENV{HTTP_REFERER} );

</%init>
<%args>
$username => undef
$password => undef
$login    => undef
$logout   => undef
</%args>
