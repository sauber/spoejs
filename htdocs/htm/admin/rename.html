<form action="" method="post">
<table>
<tr>
  <th>Current utf filename:</th>
  <th>New filename:</th>
  <th>Delete file</th>
</tr>
% foreach my $pic ( @media ) {
<tr>
<td>
<% $pic->utf_filename() %>
</td>
<td>
<input type="text" size="40" name="<% $pic->{file} %>" \
value="<% $pic->utf_filename() %>">
</td>
<td align="center">
<input type="checkbox" name="delete" value="<% $pic->{file} %>">
</td>
</tr>
% }
</table>
<input type="submit" name="submit">
</form>
<%init>
  my $user_path = "$spoejs{channel_path}/$params{d}";

  if ( defined $ARGS{submit} ) {

    delete $ARGS{submit};

    if ( defined $ARGS{delete} ) {
      foreach my $file ( @{$ARGS{delete}} ) {
	my $M = new Spoejs::Media( path => $user_path, file => $file );
	$spoejs{error}{$m->current_comp->source_file} = $M->{msg} if $M->{msg};
	$M->delete() or print "Could not delete file";
	delete $ARGS{file};
      }
    }
    delete $ARGS{delete};

    while( my ( $k, $v ) = each %ARGS ) {
      my $M = new Spoejs::Media( path => $user_path, file => $k );
      $spoejs{error}{$m->current_comp->source_file} = $M->{msg} if $M->{msg};
      $M->rename( $v );
    }
  }

  my $ML = new Spoejs::MediaList( path => $user_path );
      $spoejs{error}{$m->current_comp->source_file} = $ML->{msg} if $ML->{msg};
  my @media = $ML->list();

</%init>
<%args>
  %params => undef
</%args>