<& /w, w => 'story-page',
       story_dir => $params{d},
       story_ref => $S,
       edit_href => $a_edit,
       media_list => \@media_list
&>
<%init>
  my $path = $spoejs{channel_path} . "/" .$params{d};
  my $S = new Spoejs::Story( path => $path,
                             lang => $spoejs{lang_handle} );
  $spoejs{error}{$m->current_comp->source_file} = $S->{msg} if $S->{msg};
  my @media_list = $S->media_list();

my $a_edit = '';
if ( $session{chanauth} && $spoejs{channel} &&
     $session{chanauth}{$spoejs{channel}} ) {

  $a_edit = '<a href="';
  $a_edit .= $m->scomp( '/htm/url:encode',
			"/$spoejs{channel}/admin/story.html",
			d => $params{d} );
  $a_edit .= '">Edit</a>';
}
</%init>
<%args>
  %params => undef
</%args>
