%# Show a story with all it's data
%#
%# License: Artistic License
%#          http://www.opensource.org/licenses/artistic-license.php
%#
%# $Id: story.html,v 1.17 2004/06/13 07:58:58 snicki Exp $
%#
<& /w, w          => 'story-page',
       story_dir  => $spoejs{p}{d},
       story_ref  => $spoejs{Story},
       edit_href  => $a_edit,
       navi_opt   => \%navi_opt,
       media_list => $spoejs{Story}->{ML}
&>
<%init>
  # XXX: Make ChannelConf or user selectable
  my $count = $spoejs{ChannelConf}->get( 'thumbnail_count' );
  $count ||= 0; # 0 means All

my $a_edit;
if ( $session{chanauth} && $spoejs{channel} &&
     $session{chanauth}{$spoejs{channel}} ) {

  $a_edit = $m->scomp( '/htm/url:encode',
		       "/$spoejs{channel}/admin/story.html",
		       d => $spoejs{p}{d} );
}

my %navi_opt = ( url => "/$spoejs{channel}/story.html",
		 count => $count,
		 start => $spoejs{p}{s},
		 list_ref => $spoejs{Story}->{ML} );
</%init>
