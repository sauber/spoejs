%# Show a story with all it's data
%#
%# License: Artistic License
%#          http://www.opensource.org/licenses/artistic-license.php
%#
%# $Id: story.html,v 1.13 2004/04/09 17:56:20 sauber Exp $
%#
<& /w, w          => 'story-page',
       story_dir  => $spoejs{p}{d},
       story_ref  => $S,
       edit_href  => $a_edit,
#       next_href  => $next_href,
#       prev_href  => $prev_href,
       navi_opt   => \%navi_opt,
       media_list => \@media_list
&>
<%init>
  # XXX: Make ChannelConf or user selectable
  my $count = 20;

  my $path = $spoejs{channel_path} . "/" .$spoejs{p}{d};
  my $S = new Spoejs::Story( path => $path,
                             lang => $spoejs{lang_handle} );
  $spoejs{error}{$m->current_comp->source_file} = $S->{msg} if $S->{msg};

  my @media_list = $S->{ML}->list( start => $spoejs{p}{s},
				   count => $count );

my $a_edit;
if ( $session{chanauth} && $spoejs{channel} &&
     $session{chanauth}{$spoejs{channel}} ) {

  $a_edit = $m->scomp( '/htm/url:encode',
		       "/$spoejs{channel}/admin/story.html",
		       d => $spoejs{p}{d} );
}

my %navi_opt = ( url => "/$spoejs{channel}/story.html",
		 count => $count,
		 start => $spoejs{p}{s},
		 list_ref => $S->{ML} );
</%init>
