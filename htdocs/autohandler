%# topbar and .pm module loader
%#
%# License: Artistic License
%#          http://www.opensource.org/licenses/artistic-license.php
%#
%# $Id: autohandler,v 1.25 2004/05/19 09:49:44 snicki Exp $
%#
<& htm/header.html &>
<body>
<& /w, w=> "topbar" &>
%if ( defined $spoejs{channel} ) {
<& /w, w => "leftcolumn" &>
%#<& /w, w => "rightcolumn" &>
<div class="center_index">
%}
<% $m->call_next %>
%if ( defined $spoejs{channel} ) {
</div>
%}
<& htm/error.html &>
</body>
</html>
<%init>
if ( 1 ) {
  use Bootstring;
  use Spoejs::Archive;
  use Spoejs::ChannelConf;
  use Spoejs::ChannelList;
  use Spoejs::Icon;
  use Spoejs::Lang;
  use Spoejs::Movie;
  use Spoejs::Pic;
  use Spoejs::Resource;
  use Spoejs::SiteConf;
  use Spoejs::StoryList;
  use Spoejs::Syndication;
  use Spoejs::Text;
}

$m->comp( '/htm/session/setupSession' );
$m->comp( '/htm/session/parseParams' );

# Generate picture immediately to avoid generations of page header etc.
$m->call_next if ( $spoejs{url_noparam} =~ /pic\.common/ );
</%init>
<%filter>
if ( $spoejs{showtranslationoptions} eq 'yes' ) {
  s{\*(\w+?)\*}{($spoejs{res_handle}->get( $1 )||"*$1*") .
                ( '(' . ($spoejs{res_handle}->get( $1 )||"*$1*") . ')' )}gex;
}else{
  s{\*(\w+?)\*}{$spoejs{res_handle}->get( $1 )||"*$1*"}gex;
}
</%filter>
