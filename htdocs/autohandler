%# Handle nonhtml-users (less than 4 or more than 10 chars) calls specially
% if ( length $chan_comp < 4 or length $chan_comp > 10 ) {
<% $m->call_next %>
% } else {
%# Add header
<& html/header.html &>
<body>
<% $m->call_next %>
</body>
</html>
% }
<%init>

if ( 1 ) {
  use Spoejs::Text;
  use Spoejs::ChannelConf;
  use Spoejs::ChannelList;
  use Spoejs::Lang;
  use Spoejs::StoryList;
  use Spoejs::Resource;
  use Spoejs::Icon;
  use Spoejs::SiteConf;
}

  # The first part of the request is either the channel or a special component
  $ENV{REQUEST_URI} =~ /\/(\w+)\// and my $chan_comp = $1;

  # We need to call this here to have %spoejs available in pages that do 
  # not get thorugh dhandler
  $m->comp( '/html/session/setupSession' );
</%init>